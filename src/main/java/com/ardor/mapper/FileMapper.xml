<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper

PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"

"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ardor.mapper.FileMapper">


	<!-- 파일정보 DB에 저장 -->
	<insert id="insertFileToDB">
		insert into file(fileName,fileRealName,filePath,fileRegdate,fileTemp,folderRef,fileToken)
		values(#{fileName},#{fileRealName},#{filePath},#{fileRegdate},#{fileTemp},#{folderRef},#{fileToken})
	</insert>

	<!-- PK값으로 파일정보가져오기 -->
	<select id="getFileInfoByFileNo">
		select * from file where fileNo = #{fileNo}	
	</select>

	<!-- 파일이름으로 파일정보 가져오기 -->	
	<select id="getFileInfoFromDB" parameterType="String" resultType="fileDTO">
		select * from file where fileName = #{fileName}
	</select>
	
	
	<!-- DB수정 -->
	<update id="updateFileInfo">
		UPDATE file
		<include refid="updateColumn"></include>
		WHERE fileNo = #{fileNo};
	</update>
	
	
	<!-- Temp파일 DB삭제 -->
	<delete id="deleteTempFileFromDB">
		delete from file where fileTemp = #{fileTemp}
	</delete>
	
	<!-- 파일번호로 DB삭제 -->
	<delete id="deleteFileInfoByFileNo">
		delete from file where fileNo = #{fileNo}
	</delete>
	
	<!-- 특정 PK에 해당하는 파일 전부 가져오기 -->
	<select id="getAllFilesBysomePK" resultType="fileDTO">
		select * from file				
		<choose>
			<when test="memberNo != 0">
				where memberNo = #{memberNo}	
			</when>
			<when test="postNo != 0">
				where postNo = #{postNo}	
			</when>
			<when test="replyNo != 0">
				where replyNo = #{replyNo}	
			</when>	
		</choose>
	</select>
	
	<!-- 임시 Temp 파일 전부 가져오기 -->
	<select id="getAllTempFiles" resultType="fileDTO">
		select * from file where fileTemp = #{fileTemp}
	</select>
	
	
	<!-- 이미지 분류에 맞는 리스트 모두 가져오기 -->
	<select id="getFilesByRef" resultType="fileDTO">
		select * from file where postNo
	</select>
	

	<!-- 업데이트 필터링 -->
	<sql id="updateColumn">
		SET
	    <choose>
	        <when test="memberNo != 0" >
	        	memberNo = #{memberNo},
	        </when>
	        <when test="postNo != 0">
	        	postNo = #{postNo},
	        </when>
	        <when test="replyNo != 0">
	        	replyNo = #{replyNo},
	        </when>
	    </choose>
	    filePath = #{filePath}, fileTemp = #{fileTemp},	folderRef =#{folderRef}	
	</sql>
	

</mapper>